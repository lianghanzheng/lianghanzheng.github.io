<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>分类: LLVM Meetings - ReRoozen&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ReRoozen&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ReRoozen&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="ReRoozen&#039;s Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="ReRoozen&#039;s Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="ReRoozen"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"ReRoozen's Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"ReRoozen"},"publisher":{"@type":"Organization","name":"ReRoozen's Blog","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ReRoozen&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">LLVM Meetings</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:38:33.000Z" title="2023/12/1 22:38:33">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2024-06-30T05:35:21.042Z" title="2024/6/30 13:35:21">2024-06-30</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">1 分钟读完 (大约186个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2023/">2023</a></p><div class="content"><h2 id="MLIR-Dialect-Design"><a href="#MLIR-Dialect-Design" class="headerlink" title="MLIR Dialect Design"></a>MLIR Dialect Design</h2><p>@(Modular, Nvidia)</p>
<ul>
<li>Dialect procides contracts over the semantics of their ops, atributues, and types</li>
<li>Type system is less malleable than operations</li>
</ul>
<p>MLIR compiler components：</p>
<ol>
<li>importer：从AST，ML编译器的图、bytecode等格式读取程序</li>
<li>funnel：将多种输入转换为统一的表示形式</li>
<li>legalizer &amp; optimizer</li>
<li>specializer：将通用MLIR向目标平台特化</li>
<li>exporter：将MLIR表示转换为外部系统需要的格式，如LLVM IR</li>
</ol>
<p>比如，<code>tosa</code> 属于legalizer的范畴；<code>linalg</code>, <code>affine</code>, <code>scf</code> 等属于optimizer的范畴；<code>omp</code> 属于specializer的范畴；<code>llvm</code> 属于funnel的范畴。</p>
<h2 id="Extensible-and-Composable-Dataflow-Analysis-in-MLIR"><a href="#Extensible-and-Composable-Dataflow-Analysis-in-MLIR" class="headerlink" title="Extensible and Composable Dataflow Analysis in MLIR"></a>Extensible and Composable Dataflow Analysis in MLIR</h2><h2 id="Using-MLIR-to-Optimize-Basic-Linear-Algebraic-Subprograms"><a href="#Using-MLIR-to-Optimize-Basic-Linear-Algebraic-Subprograms" class="headerlink" title="Using MLIR to Optimize Basic Linear Algebraic Subprograms"></a>Using MLIR to Optimize Basic Linear Algebraic Subprograms</h2><h2 id="MachineScheduler-fine-grain-resource-allocation-using-resource-intervals"><a href="#MachineScheduler-fine-grain-resource-allocation-using-resource-intervals" class="headerlink" title="MachineScheduler - fine grain resource allocation using resource intervals"></a>MachineScheduler - fine grain resource allocation using resource intervals</h2><h2 id="Practical-Global-Merge-Function-with-ThinLTO"><a href="#Practical-Global-Merge-Function-with-ThinLTO" class="headerlink" title="Practical Global Merge Function with ThinLTO"></a>Practical Global Merge Function with ThinLTO</h2><h2 id="mlir-meminfo-A-Memory-Model-for-MLIR"><a href="#mlir-meminfo-A-Memory-Model-for-MLIR" class="headerlink" title="mlir-meminfo : A Memory Model for MLIR"></a>mlir-meminfo : A Memory Model for MLIR</h2><h2 id="A-whirlwind-tour-of-the-LLVM-optimizer"><a href="#A-whirlwind-tour-of-the-LLVM-optimizer" class="headerlink" title="A whirlwind tour of the LLVM optimizer"></a>A whirlwind tour of the LLVM optimizer</h2><h2 id="Developing-BOLT-pass"><a href="#Developing-BOLT-pass" class="headerlink" title="Developing BOLT pass"></a>Developing BOLT pass</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:38:30.000Z" title="2023/12/1 22:38:30">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-07T08:47:28.218Z" title="2023/12/7 16:47:28">2023-12-07</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">1 分钟读完 (大约112个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2022/">2022</a></p><div class="content"><h2 id="Precise-Polyhedral-Analyses-For-MLIR-using-the-FPL-Presburger-Library"><a href="#Precise-Polyhedral-Analyses-For-MLIR-using-the-FPL-Presburger-Library" class="headerlink" title="Precise Polyhedral Analyses For MLIR using the FPL Presburger Library"></a>Precise Polyhedral Analyses For MLIR using the FPL Presburger Library</h2><h2 id="How-to-write-a-new-compiler-driver-The-LLVM-Flang-perspective"><a href="#How-to-write-a-new-compiler-driver-The-LLVM-Flang-perspective" class="headerlink" title="How to write a new compiler driver? The LLVM Flang perspective"></a>How to write a new compiler driver? The LLVM Flang perspective</h2><h2 id="Paths-towards-unifying-LLVM-and-MLIR"><a href="#Paths-towards-unifying-LLVM-and-MLIR" class="headerlink" title="Paths towards unifying LLVM and MLIR"></a>Paths towards unifying LLVM and MLIR</h2><h2 id="Heterogeneous-Debug-Metadata-in-LLVM"><a href="#Heterogeneous-Debug-Metadata-in-LLVM" class="headerlink" title="Heterogeneous Debug Metadata in LLVM"></a>Heterogeneous Debug Metadata in LLVM</h2><h2 id="What-does-it-take-to-run-LLVM-Buildbots"><a href="#What-does-it-take-to-run-LLVM-Buildbots" class="headerlink" title="What does it take to run LLVM Buildbots?"></a>What does it take to run LLVM Buildbots?</h2><h2 id="VAST-MLIR-for-program-analysis-of-C-C"><a href="#VAST-MLIR-for-program-analysis-of-C-C" class="headerlink" title="VAST: MLIR for program analysis of C&#x2F;C++"></a>VAST: MLIR for program analysis of C&#x2F;C++</h2><h2 id="SPIR-V-Backend-in-LLVM-Upstream-and-Beyond"><a href="#SPIR-V-Backend-in-LLVM-Upstream-and-Beyond" class="headerlink" title="SPIR-V Backend in LLVM: Upstream and Beyond"></a>SPIR-V Backend in LLVM: Upstream and Beyond</h2><p>@Intel</p>
<ul>
<li>SPIR-V LLVM translator is a production-ready bi-direction “bridge” between LLVM IR and SPIR-V.</li>
<li>SPIR-V is much closer to LLVM IR than to MIR</li>
<li>Instruction Selection<ul>
<li>Relying on TabelGen as much as possible</li>
<li>Type information folding</li>
<li>No “real” registers in SPIR-V</li>
</ul>
</li>
</ul>
<h2 id="llvm-dialects-bringing-dialects-to-the-LLVM-IR-substrate"><a href="#llvm-dialects-bringing-dialects-to-the-LLVM-IR-substrate" class="headerlink" title="llvm-dialects: bringing dialects to the LLVM IR substrate"></a>llvm-dialects: bringing dialects to the LLVM IR substrate</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:38:25.000Z" title="2023/12/1 22:38:25">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-07T08:27:38.944Z" title="2023/12/7 16:27:38">2023-12-07</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">1 分钟读完 (大约120个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2021/">2021</a></p><div class="content"><h2 id="FPL-A-Presburger-Library-in-MLIR"><a href="#FPL-A-Presburger-Library-in-MLIR" class="headerlink" title="FPL: A Presburger Library in MLIR"></a>FPL: A Presburger Library in MLIR</h2><h2 id="Enabling-Interactive-C-with-Clang"><a href="#Enabling-Interactive-C-with-Clang" class="headerlink" title="Enabling Interactive C++ with Clang"></a>Enabling Interactive C++ with Clang</h2><h2 id="Deconstructing-the-Myth-“Only-real-coders-contribute-to-LLVM-”-Takeaways"><a href="#Deconstructing-the-Myth-“Only-real-coders-contribute-to-LLVM-”-Takeaways" class="headerlink" title="Deconstructing the Myth: “Only real coders contribute to LLVM!”? - Takeaways"></a>Deconstructing the Myth: “Only real coders contribute to LLVM!”? - Takeaways</h2><h2 id="Extending-LLVM’s-optimization-repertoire-to-build-a-highly-optimizing-compiler"><a href="#Extending-LLVM’s-optimization-repertoire-to-build-a-highly-optimizing-compiler" class="headerlink" title="Extending LLVM’s optimization repertoire to build a highly optimizing compiler"></a>Extending LLVM’s optimization repertoire to build a highly optimizing compiler</h2><h2 id="SPIR-V-support-in-LLVM-and-Clang"><a href="#SPIR-V-support-in-LLVM-and-Clang" class="headerlink" title="SPIR-V support in LLVM and Clang"></a>SPIR-V support in LLVM and Clang</h2><p>@Khronos group</p>
<p>Similar to LLVM IR, BUT DIFFERENT!</p>
<ul>
<li>Core specifications, defined by the Khronos SPIR-V group</li>
<li>Environment specifications, defined by the client API<ul>
<li>Can apply more restrictions to core specifications</li>
</ul>
</li>
<li>Extended instruction sets<ul>
<li>Extra instructions a client API can define</li>
</ul>
</li>
</ul>
<h3 id="Current-state"><a href="#Current-state" class="headerlink" title="Current state"></a>Current state</h3><ul>
<li><code>llvm-spirv text.bc -o test.spv</code></li>
<li><code>spirv-link</code>, <code>spirv-opt</code>, <code>spirv-val</code> from <a target="_blank" rel="noopener" href="https://github.com/KhronosGroup/SPIRV-Tools">https://github.com/KhronosGroup/SPIRV-Tools</a><br><br><code>spirv-link -o app.spv test.spv</code></li>
</ul>
<h2 id="Architecting-out-of-tree-LLVM-projects-using-cmake"><a href="#Architecting-out-of-tree-LLVM-projects-using-cmake" class="headerlink" title="Architecting out-of-tree LLVM projects using cmake"></a>Architecting out-of-tree LLVM projects using cmake</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:38:22.000Z" title="2023/12/1 22:38:22">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-06T04:53:35.196Z" title="2023/12/6 12:53:35">2023-12-06</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">几秒读完 (大约39个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2020/">2020</a></p><div class="content"><h2 id="Code-Size-Compiler-Optimizations-and-Techniques"><a href="#Code-Size-Compiler-Optimizations-and-Techniques" class="headerlink" title="Code Size Compiler Optimizations and Techniques"></a>Code Size Compiler Optimizations and Techniques</h2><h2 id="CIL-Common-MLIR-Dialect-for-C-C-and-Fortran"><a href="#CIL-Common-MLIR-Dialect-for-C-C-and-Fortran" class="headerlink" title="CIL : Common MLIR Dialect for C&#x2F;C++ and Fortran"></a>CIL : Common MLIR Dialect for C&#x2F;C++ and Fortran</h2><h2 id="Everything-I-know-about-debugging-LLVM"><a href="#Everything-I-know-about-debugging-LLVM" class="headerlink" title="Everything I know about debugging LLVM"></a>Everything I know about debugging LLVM</h2><h2 id="LLVM-in-a-Bare-Metal-Environment"><a href="#LLVM-in-a-Bare-Metal-Environment" class="headerlink" title="LLVM in a Bare Metal Environment"></a>LLVM in a Bare Metal Environment</h2><h2 id="Understanding-Changes-made-by-a-Pass-in-the-Opt-Pipeline"><a href="#Understanding-Changes-made-by-a-Pass-in-the-Opt-Pipeline" class="headerlink" title="Understanding Changes made by a Pass in the Opt Pipeline"></a>Understanding Changes made by a Pass in the Opt Pipeline</h2><h2 id="MLIR-Tutorial"><a href="#MLIR-Tutorial" class="headerlink" title="MLIR Tutorial"></a>MLIR Tutorial</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:38:10.000Z" title="2023/12/1 22:38:10">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-16T14:36:48.966Z" title="2023/12/16 22:36:48">2023-12-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">11 分钟读完 (大约1582个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2019/">2019</a></p><div class="content"><h2 id="MLIR-Multi-Level-Intermediate-Representation-for-Compiler-Infrastructure"><a href="#MLIR-Multi-Level-Intermediate-Representation-for-Compiler-Infrastructure" class="headerlink" title="MLIR: Multi-Level Intermediate Representation for Compiler Infrastructure"></a>MLIR: Multi-Level Intermediate Representation for Compiler Infrastructure</h2><h3 id="Why-new-compiler-infrastructure"><a href="#Why-new-compiler-infrastructure" class="headerlink" title="Why new compiler infrastructure?"></a>Why new compiler infrastructure?</h3><p>Swift:</p>
<ul>
<li>A higher level language</li>
<li>Extra optimizations like closure optimization and reference counting optimization are needed<ul>
<li>LLVM IR are too low level to support that</li>
</ul>
</li>
<li>Have to introduce SIL IR<ul>
<li>CIL IR for modern Clang AST</li>
<li>MIR IR for Rust AST</li>
<li>Julia IR for Julia AST</li>
<li>…</li>
</ul>
</li>
</ul>
<h3 id="MLIR"><a href="#MLIR" class="headerlink" title="MLIR"></a>MLIR</h3><ul>
<li>Similar to LLVM IR</li>
<li>Type system is extensible</li>
<li>MLIR operations:<ul>
<li>opcode and location info</li>
<li>everything an instruction has (oprands, attributes, …)</li>
</ul>
</li>
<li>MLIR Dialects<ul>
<li>Families of defined operations</li>
<li>Set of defined operations<ul>
<li>Custom parser, printer, verifier</li>
</ul>
</li>
<li>Entirely custom type system</li>
<li>Customization hooks</li>
</ul>
</li>
</ul>
<h4 id="An-exmaple"><a href="#An-exmaple" class="headerlink" title="An exmaple"></a>An exmaple</h4><p>Declarative Op definitions:</p>
<ul>
<li>Specified using TableGen</li>
<li>Dialect can create own hierarchies</li>
<li>Specify op properties</li>
<li>Name input and output operands</li>
<li>Document along with the op</li>
</ul>
<p>More than definition:</p>
<ul>
<li>Tranform the defined opertion into another</li>
<li>mlir-opt</li>
<li>mlir-translate - test data structure translations</li>
</ul>
<h3 id="MLIR-Clang"><a href="#MLIR-Clang" class="headerlink" title="MLIR + Clang"></a>MLIR + Clang</h3><ul>
<li>CIL: a high-level IR for Clang</li>
<li>OpenMP dialect</li>
<li>…</li>
</ul>
<h2 id="Handling-massive-concurrency-Development-of-a-programming-model-for-GPU-and-CPU"><a href="#Handling-massive-concurrency-Development-of-a-programming-model-for-GPU-and-CPU" class="headerlink" title="Handling massive concurrency: Development of a programming model for GPU and CPU"></a>Handling massive concurrency: Development of a programming model for GPU and CPU</h2><h2 id="SYCL-compiler-zero-cost-abstraction-and-type-safety-for-heterogeneous-computing"><a href="#SYCL-compiler-zero-cost-abstraction-and-type-safety-for-heterogeneous-computing" class="headerlink" title="SYCL compiler: zero-cost abstraction and type safety for heterogeneous computing"></a>SYCL compiler: zero-cost abstraction and type safety for heterogeneous computing</h2><h2 id="Loop-Fusion-Loop-Distribution-and-their-Place-in-the-Loop-Optimization-Pipeline"><a href="#Loop-Fusion-Loop-Distribution-and-their-Place-in-the-Loop-Optimization-Pipeline" class="headerlink" title="Loop Fusion, Loop Distribution and their Place in the Loop Optimization Pipeline"></a>Loop Fusion, Loop Distribution and their Place in the Loop Optimization Pipeline</h2><h2 id="Tutorial-Building-a-Compiler-with-MLIR"><a href="#Tutorial-Building-a-Compiler-with-MLIR" class="headerlink" title="Tutorial: Building a Compiler with MLIR"></a>Tutorial: Building a Compiler with MLIR</h2><h3 id="A-toy-language"><a href="#A-toy-language" class="headerlink" title="A toy language"></a>A toy language</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def foo(a, b, c) &#123;</span><br><span class="line">  var c = a*b;</span><br><span class="line">  print(transpose(c));</span><br><span class="line">  var d&lt;2, 4&gt; = v * foo(c);</span><br><span class="line">  return d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MLIR is all you need for lowering:</p>
<ul>
<li>Toy AST - MLIR dialect</li>
<li>TIR - MLIR dialect</li>
<li>LLVM IR - MLIR dialect</li>
</ul>
<h3 id="Primer"><a href="#Primer" class="headerlink" title="Primer"></a>Primer</h3><h4 id="Operation-no-instruction"><a href="#Operation-no-instruction" class="headerlink" title="Operation, no instruction"></a>Operation, no instruction</h4><p>表示 <code>transpose</code> 函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%0 = &quot;toy.transpose&quot;(%arg1) : (!toy&lt;&quot;array&lt;2, 3&gt;&quot;&gt;</span><br><span class="line">  -&gt; !toy&lt;&quot;array&lt;3, 2&gt;&quot;&gt; loc(&quot;test/codegen.toy&quot;:3:14))</span><br></pre></td></tr></table></figure>

<p>对应的MLIR源代码为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Operation *<span class="title">creteTransposeOp</span><span class="params">(FuncBuilder *builder, MLIRContext *ctx, Value *input_array, Location location)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// bundle our custom type in a `toy` dialect</span></span><br><span class="line">  <span class="keyword">auto</span> toyDialect = Identifier::<span class="built_in">get</span>(<span class="string">&quot;toy&quot;</span>, ctx);</span><br><span class="line">  <span class="comment">// create custom type for array&lt;3, 2&gt;</span></span><br><span class="line">  <span class="keyword">auto</span> type = OpaqueType::<span class="built_in">get</span>(toyDialect, <span class="string">&quot;array&lt;3, 2&gt;&quot;</span>, ctx);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fill in the `OperationState` with the required fields.</span></span><br><span class="line">  <span class="function">OperationState <span class="title">result</span><span class="params">(ctx, location, <span class="string">&quot;toy.transpose&quot;</span>)</span></span>;</span><br><span class="line">  results.type.<span class="built_in">push_back</span>(type); <span class="comment">// return type;</span></span><br><span class="line">  result.operands.<span class="built_in">push_back</span>(input_value); <span class="comment">// arguments</span></span><br><span class="line">  Operation *newTransposeOp = builder-&gt;<span class="built_in">createOperation</span>(result);</span><br><span class="line">  <span class="keyword">return</span> newTransposeOp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A MLIR dialect includes:</p>
<ul>
<li>A prefix (toy)</li>
<li>A list of custom types, each its C++ class</li>
<li>A list of operations and C++ class implementation:<ul>
<li>Verify for operation invariants</li>
<li>Semantics (has-no-effects, constant-foldingm CSE-allowed, …)</li>
</ul>
</li>
<li>Possible custom parser and assembly printer</li>
<li>Passes: analysis, transformations, and dialect conversions</li>
</ul>
<h3 id="High-level-transformation"><a href="#High-level-transformation" class="headerlink" title="High-level transformation"></a>High-level transformation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def no_op(b) &#123;</span><br><span class="line">  return transpose(transpose(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里实际上无事发生，但是clang中解析出的依赖分析并不能消除这个无效操作。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SimplifyRedundantTranspose</span>: <span class="keyword">public</span> RewritePattern &#123;</span><br><span class="line">  <span class="comment">// register pattern to match every toy.transpose in the IR</span></span><br><span class="line">  <span class="built_in">SimplifyRedundantTranspose</span>(MLIRContext *ctx):</span><br><span class="line">    <span class="built_in">RewritePattern</span>(TransposeOp::<span class="built_in">getOperationName</span>(), <span class="comment">/* benefit = */</span> <span class="number">1</span>, context) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">PatternMatchResult <span class="title">matchAndRewrite</span><span class="params">(Operation *op, PatternRewriter &amp;rewriter)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="comment">// directly cast current operation</span></span><br><span class="line">    TransposeOp transpose = op-&gt;<span class="built_in">cast</span>&lt;TransposeOp&gt;();</span><br><span class="line">    <span class="comment">// look through the input</span></span><br><span class="line">    mlir::Value *transposeInput = transpose.<span class="built_in">getOperand</span>();</span><br><span class="line">    mlir::Operation *transposeInputInst = transposeInput-&gt;<span class="built_in">getDefiningOp</span>();</span><br><span class="line">    <span class="comment">// Input is defined by another transpose, match it!</span></span><br><span class="line">    TransposeOp transposeInputOp = <span class="built_in">dyn_cast_or_null</span>&lt;TransposeOp&gt;(transposeInput);</span><br><span class="line">    <span class="keyword">if</span> (!transposeInputOp)</span><br><span class="line">      <span class="keyword">return</span> matchFailure;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// rewrite and performe replacement</span></span><br><span class="line">    rewriter.<span class="built_in">replaceOp</span>(op, &#123; transposeInputOp.<span class="built_in">getOperand</span>() &#125;, &#123; transposeInputOp &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">matchSuccess</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个定义也能够用TableGen进行表达，而且比较简单。</p>
<h3 id="Lowering-dialect-to-LLVM"><a href="#Lowering-dialect-to-LLVM" class="headerlink" title="Lowering dialect to LLVM"></a>Lowering dialect to LLVM</h3><p>Convert to the standard dialect for codegen or any other dialect:</p>
<ul>
<li>Function signature conversion</li>
<li>Type conversion</li>
<li>Operation conversion</li>
</ul>
<h2 id="Building-an-LLVM-based-tool-lessons-learned"><a href="#Building-an-LLVM-based-tool-lessons-learned" class="headerlink" title="Building an LLVM-based tool: lessons learned"></a>Building an LLVM-based tool: lessons learned</h2><h2 id="LLVM-IR-Tutorial-Phis-GEPs-and-other-things-oh-my"><a href="#LLVM-IR-Tutorial-Phis-GEPs-and-other-things-oh-my" class="headerlink" title="LLVM IR Tutorial - Phis, GEPs and other things, oh my!"></a>LLVM IR Tutorial - Phis, GEPs and other things, oh my!</h2><p>@Intel</p>
<p>LLVM IR</p>
<ul>
<li>RISC-like</li>
</ul>
<h3 id="Target-info"><a href="#Target-info" class="headerlink" title="Target info"></a>Target info</h3><figure class="highlight llvm"><figcaption><span>IR</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target</span> <span class="keyword">datalayout</span> <span class="operator">=</span> </span><br><span class="line">  <span class="string">&quot;e-m:e-i64:64-f80:128-n8:16:32:64-S128&quot;</span></span><br><span class="line"><span class="keyword">target</span> <span class="keyword">triple</span> <span class="operator">=</span> <span class="string">&quot;x86_64-unknown-linux-gnu&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Data layout: “little endian-ELF mangling-ABI alignment of i64-?-Native interger widths-?”</li>
<li>Target: “Architecture-vendor-system-ABI”</li>
</ul>
<h3 id="Baisc-program"><a href="#Baisc-program" class="headerlink" title="Baisc program"></a>Baisc program</h3><ul>
<li>Types everywhere<ul>
<li>NO implicit conversions</li>
<li><code>opt -verify input.ll</code> 用来检查LLVM IR中类型是否正确</li>
</ul>
</li>
<li>Instructions have many variants</li>
</ul>
<h4 id="CFG"><a href="#CFG" class="headerlink" title="CFG"></a>CFG</h4><ul>
<li>因分支指令产生<ul>
<li><code>br</code></li>
<li><code>ret</code></li>
</ul>
</li>
<li>每个基本块都由名字<ul>
<li>不一定是显式的，如 <code>%0</code> 也能作为名字，且变量不能重复使用这个名字</li>
</ul>
</li>
</ul>
<p>打印一个CFG：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Don&#x27;t include instructions per block</span></span><br><span class="line">opt -analysis -dot-cfg-only input.ll</span><br><span class="line"><span class="comment"># Include instrcutions</span></span><br><span class="line">opt -analysis -dot-cfg input.ll</span><br></pre></td></tr></table></figure>

<h5 id="一个for循环"><a href="#一个for循环" class="headerlink" title="一个for循环"></a>一个for循环</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define i32 @foo(i32 %val)&#123;</span><br><span class="line">entry:</span><br><span class="line">  ...</span><br><span class="line">check_for_condition:</span><br><span class="line">  ...</span><br><span class="line">for body:</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>变量：</p>
<figure class="highlight llvm"><figcaption><span>IR</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%i.addr</span> <span class="operator">=</span> <span class="keyword">alloca</span> <span class="type">i32</span></span><br><span class="line"><span class="keyword">store</span> <span class="type">i32</span> <span class="number">2</span><span class="punctuation">,</span> <span class="type">i32</span>* <span class="variable">%i.addr</span></span><br></pre></td></tr></table></figure>

<p>数组：</p>
<figure class="highlight llvm"><figcaption><span>IR</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%array</span> <span class="operator">=</span> <span class="keyword">global</span> [<span class="number">10</span> <span class="keyword">x</span> <span class="type">i32</span>]</span><br><span class="line">// get element pointer instruction</span><br><span class="line"><span class="variable">%new_ptr</span> <span class="operator">=</span> <span class="keyword">getelementptr</span> <span class="type">i32</span><span class="punctuation">,</span> <span class="type">i32</span>* <span class="variable">%array</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的指针是i32类型。</p>
</blockquote>
<h4 id="GEP操作"><a href="#GEP操作" class="headerlink" title="GEP操作"></a>GEP操作</h4><figure class="highlight llvm"><figcaption><span>IR</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">@a_gv</span> <span class="operator">=</span> <span class="keyword">global</span> [<span class="number">6</span> <span class="keyword">x</span> <span class="type">i8</span>] zeroinitilizer</span><br><span class="line"><span class="variable">%new_ptr</span> <span class="operator">=</span> <span class="keyword">getelementptr</span> [<span class="number">6</span> <span class="keyword">x</span> <span class="number">18</span>]<span class="punctuation">,</span> [<span class="number">6</span> <span class="keyword">x</span> <span class="type">i8</span>]* <span class="title">@a_gv</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">1</span></span><br><span class="line"><span class="variable">%elem_pt</span> <span class="operator">=</span> <span class="keyword">getelementptr</span> [<span class="number">6</span> <span class="keyword">x</span> <span class="type">i8</span>]<span class="punctuation">,</span> [<span class="number">6</span> <span class="keyword">x</span> <span class="type">i8</span>]* <span class="title">@a_gv</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">0</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>GEP NEVER load from memory.</p>
<blockquote>
<p>这里的指针是一个数组类型。</p>
</blockquote>
<p>两者之间的区别是，最后的偏移量每个单位的距离由基本类型执行，第一个 <code>new_ptr</code> 相当于 <code>array[1]</code>，第二个 <code>new_ptr</code> 相当于 <code>a_gv[7]</code>。</p>
<p><code>elem_pt</code> 从 <code>@a_gv</code> 的0号 <code>[6 x i8]</code> 的分组中取出0号元素。</p>
<h4 id="Aggregate-type"><a href="#Aggregate-type" class="headerlink" title="Aggregate type"></a>Aggregate type</h4><figure class="highlight llvm"><figcaption><span>IR</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%MyStruct</span> <span class="operator">=</span> <span class="keyword">type</span> &lt;&#123; <span class="type">i8</span><span class="punctuation">,</span> <span class="type">i32</span><span class="punctuation">,</span> [<span class="number">3</span> <span class="keyword">x</span> <span class="type">i32</span>] &#125;&gt;</span><br><span class="line"><span class="title">@a_gv</span> <span class="operator">=</span> <span class="keyword">global</span> <span class="variable">%MyStruct</span> &#123; <span class="type">i8</span> <span class="number">99</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">17</span><span class="punctuation">,</span> [<span class="type">i32</span> <span class="number">1</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">2</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">3</span>] &#125;</span><br><span class="line"><span class="variable">%new_ptr</span> <span class="operator">=</span> <span class="keyword">getelementptr</span> <span class="variable">%MyStruct</span>*<span class="punctuation">,</span> <span class="variable">%MyStruct</span>* a_gv<span class="punctuation">,</span> <span class="type">i32</span> <span class="number">0</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">2</span><span class="punctuation">,</span> <span class="type">i32</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h4><ul>
<li>使用 <code>@</code> 开始而不是 <code>%</code></li>
<li>global keyword<ul>
<li><code>@gv = global i8 42</code></li>
<li><code>@gv = constant i8 42</code></li>
</ul>
</li>
</ul>
<h2 id="Hot-Cold-Splitting-Optimization-Pass-In-LLVM"><a href="#Hot-Cold-Splitting-Optimization-Pass-In-LLVM" class="headerlink" title="Hot Cold Splitting Optimization Pass In LLVM"></a>Hot Cold Splitting Optimization Pass In LLVM</h2><h2 id="Writing-Loop-Optimizations-in-LLVM"><a href="#Writing-Loop-Optimizations-in-LLVM" class="headerlink" title="Writing Loop Optimizations in LLVM"></a>Writing Loop Optimizations in LLVM</h2><p>@IBM</p>
<h3 id="Terms"><a href="#Terms" class="headerlink" title="Terms"></a>Terms</h3><p><a target="_blank" rel="noopener" href="https://llvm.org/docs/LoopTerminology.html">Loop representation</a>:</p>
<ul>
<li>Preheader: A single edge to the header of the loop from outside of the loop</li>
<li>Header: Single entry point to the loop that dominates all other blocks in the loop</li>
<li>Exiting block: The block within the loop that has successors outside of the loop; if multiple blocks have such successors, this is NULL</li>
<li>Latch: Block that contains the branch back to the loop header</li>
<li>Exit block: The successor block of this loop.</li>
</ul>
<h4 id="Loop-closed-SSA-form"><a href="#Loop-closed-SSA-form" class="headerlink" title="Loop closed SSA form"></a>Loop closed SSA form</h4><p>循环中所有的使用的变量都是在循环内部定义的，这使得phi函数只能在循环的出口处被定义。</p>
<ul>
<li><code>llvm::formLCSSA</code></li>
</ul>
<h3 id="Rotated-Loops"><a href="#Rotated-Loops" class="headerlink" title="Rotated Loops"></a>Rotated Loops</h3><ul>
<li>Covert a loop into a <code>do/while</code> style loop</li>
<li>Canonicalize loop latch to have a single predecessor</li>
<li>When the compiler cannot prove loop body will excute &gt;&#x3D;1, insert a guard</li>
<li>It also inserts a loop epilogue, that will be excuted once after the body is finished executing</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> A[<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> B[<span class="number">100</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">example</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i)</span><br><span class="line">    A[i] = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Loop-pipeline"><a href="#Loop-pipeline" class="headerlink" title="Loop pipeline"></a>Loop pipeline</h3><ul>
<li>Pipeline builder<ul>
<li>Passes enabled by switch (UnrollAndJam)</li>
<li>Added passes, but do nothing bu default (LoopVectorize, LoopUnroll)</li>
<li>Passes added in EP callbacks (Polly)</li>
<li>Passes never added by pass builder</li>
</ul>
</li>
<li>Transformation order follows pass pipeline<ul>
<li>Eixpoint within <code>LoopPassManager</code> using <code>Updater</code></li>
</ul>
</li>
<li>Non-loop passes in-between</li>
<li>Some passes are <code>FunctionPasses</code></li>
</ul>
<h4 id="Loop-pass-v-s-function-pass"><a href="#Loop-pass-v-s-function-pass" class="headerlink" title="Loop pass v.s. function pass"></a>Loop pass v.s. function pass</h4><p>Consider a FunctionPass first:</p>
<ul>
<li>Better maintained</li>
<li>No LoopPassManager needed<ul>
<li>May require adding function analyses by proxy</li>
</ul>
</li>
<li>No requirement to preserve DominatorTree, LoopAnalysis, LoopSimplify, LCSSA</li>
<li>Control over loop processing order &#x2F; reprocessing behaviour</li>
</ul>
<p>Reasons to write a LoopPass:</p>
<ul>
<li>Apply multiple passes on same loop before processing nest<ul>
<li>i.a. Improved locality</li>
</ul>
</li>
<li>Share reprocessing behaviour with other loop passes</li>
<li>Add pass at the Loop EP Callbacks</li>
<li>Analysis used by other loop passes</li>
</ul>
<h3 id="Demo-Basic-loop-optimization-pass-using-new-pass-manager"><a href="#Demo-Basic-loop-optimization-pass-using-new-pass-manager" class="headerlink" title="Demo: Basic loop optimization pass using new pass manager"></a>Demo: Basic loop optimization pass using new pass manager</h3><h4 id="Step1-Basic-loop-optimization-template"><a href="#Step1-Basic-loop-optimization-template" class="headerlink" title="Step1: Basic loop optimization template"></a><a target="_blank" rel="noopener" href="https://github.com/kitbarton/llvm-project/pull/1">Step1: Basic loop optimization template</a></h4><p>进入网页点开Files changed</p>
<ul>
<li><code>LoopOptTutorial.h</code> 和 <code>LoopOptTutorial.cpp</code> 共同创建了一个编译遍<br><br>目前这个编译遍只是打印了哪些循环被传入了这个pass</li>
<li>对 <code>LoopPassBuilder.cpp</code>、<code>PassRegistry.def</code> 的修改将这个新编写的pass在管理器中注册</li>
<li>对 <code>CMakeLists.txt</code> 的修改让这个Pass被添加进项目中</li>
<li><code>simple.ll</code> 和 <code>loop_nest.ll</code> 是测试样例</li>
</ul>
<h4 id="Step2-Select-Filter-candidate-loops"><a href="#Step2-Select-Filter-candidate-loops" class="headerlink" title="Step2: Select&#x2F;Filter candidate loops"></a><a target="_blank" rel="noopener" href="https://github.com/kitbarton/llvm-project/pull/2">Step2: Select&#x2F;Filter candidate loops</a></h4><ul>
<li>在Pass中增加了对Loop的检查，是否能够进行优化</li>
</ul>
<h4 id="Step3-Add-code-to-split-a-candidate-loop"><a href="#Step3-Add-code-to-split-a-candidate-loop" class="headerlink" title="Step3: Add code to split a candidate loop"></a><a target="_blank" rel="noopener" href="https://github.com/kitbarton/llvm-project/pull/3">Step3: Add code to split a candidate loop</a></h4><p>比较重要的成员函数：</p>
<ul>
<li><code>splitLoopInHalf</code>：对满足条件的循环进行分裂</li>
<li><code>cloneLoop</code>：复制一个循环</li>
<li><code>computeSplitPoint</code>：计算分割点</li>
</ul>
<h4 id="Step4-Use-DomTreeUpdater-to-update-the-dominator-tree"><a href="#Step4-Use-DomTreeUpdater-to-update-the-dominator-tree" class="headerlink" title="Step4: Use DomTreeUpdater to update the dominator tree"></a><a target="_blank" rel="noopener" href="https://github.com/kitbarton/llvm-project/pull/4">Step4: Use DomTreeUpdater to update the dominator tree</a></h4><p>变换后的代码需要能够插入会原本的代码中进行更新。</p>
<h4 id="Step5-Use-STATISTICS-and-OpmizationRemarkEmitter-to-report-outcome"><a href="#Step5-Use-STATISTICS-and-OpmizationRemarkEmitter-to-report-outcome" class="headerlink" title="Step5: Use STATISTICS and OpmizationRemarkEmitter to report outcome"></a><a target="_blank" rel="noopener" href="https://github.com/kitbarton/llvm-project/pull/5">Step5: Use STATISTICS and OpmizationRemarkEmitter to report outcome</a></h4><ul>
<li><code>OptimizationRemarkAnalysis</code></li>
</ul>
<h3 id="Dependence-graphs"><a href="#Dependence-graphs" class="headerlink" title="Dependence graphs"></a>Dependence graphs</h3><ul>
<li>Theory:<ul>
<li>Deendence Garphs and Compiler Optimizations (1981), D.J. Kuch et al.</li>
<li>The Program Dependence Graph and Its Use in Optimizations (1987) J. Ferrante et al.</li>
</ul>
</li>
<li>Dependence graph types:<ul>
<li>Data Dependence Graph (DDG)</li>
<li>Program Dependence Graph (PDG): also consider control flow</li>
</ul>
</li>
</ul>
<h2 id="An-overview-of-LLVM"><a href="#An-overview-of-LLVM" class="headerlink" title="An overview of LLVM"></a>An overview of LLVM</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:30:17.000Z" title="2023/12/1 22:30:17">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-01T14:37:48.256Z" title="2023/12/1 22:37:48">2023-12-01</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">几秒读完 (大约96个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2018/">2018</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2018-04/">https://llvm.org/devmtg/2018-04/</a></p>
<p><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2018-10/">https://llvm.org/devmtg/2018-10/</a></p>
<h2 id="Global-code-completion-and-architecture-of-clangd"><a href="#Global-code-completion-and-architecture-of-clangd" class="headerlink" title="Global code completion and architecture of clangd"></a>Global code completion and architecture of clangd</h2><h2 id="Porting-Function-merging-pass-to-thinlto"><a href="#Porting-Function-merging-pass-to-thinlto" class="headerlink" title="Porting Function merging pass to thinlto"></a>Porting Function merging pass to thinlto</h2><h2 id="Understanding-the-performance-of-code-using-LLVM’s-Machine-Code-Analyzer-llvm-mca"><a href="#Understanding-the-performance-of-code-using-LLVM’s-Machine-Code-Analyzer-llvm-mca" class="headerlink" title="Understanding the performance of code using LLVM’s Machine Code Analyzer (llvm-mca)"></a>Understanding the performance of code using LLVM’s Machine Code Analyzer (llvm-mca)</h2><h2 id="Implementing-an-OpenCL-compiler-for-CPU-in-LLVM"><a href="#Implementing-an-OpenCL-compiler-for-CPU-in-LLVM" class="headerlink" title="Implementing an OpenCL compiler for CPU in LLVM"></a>Implementing an OpenCL compiler for CPU in LLVM</h2><h2 id="Loop-Transformations-in-LLVM-The-Good-the-Bad-and-the-Ugly"><a href="#Loop-Transformations-in-LLVM-The-Good-the-Bad-and-the-Ugly" class="headerlink" title="Loop Transformations in LLVM: The Good, the Bad, and the Ugly"></a>Loop Transformations in LLVM: The Good, the Bad, and the Ugly</h2><h2 id="Memory-Tagging-how-it-improves-C-memory-safety-and-what-does-it-mean-for-compiler-optimizations"><a href="#Memory-Tagging-how-it-improves-C-memory-safety-and-what-does-it-mean-for-compiler-optimizations" class="headerlink" title="Memory Tagging, how it improves C++ memory safety, and what does it mean for compiler optimizations"></a>Memory Tagging, how it improves C++ memory safety, and what does it mean for compiler optimizations</h2><h2 id="Revisiting-Loop-Fusion-and-its-place-in-the-loop-transformation-framework"><a href="#Revisiting-Loop-Fusion-and-its-place-in-the-loop-transformation-framework" class="headerlink" title="Revisiting Loop Fusion, and its place in the loop transformation framework"></a>Revisiting Loop Fusion, and its place in the loop transformation framework</h2><h2 id="How-to-use-LLVM-to-optimize-your-parallel-programs"><a href="#How-to-use-LLVM-to-optimize-your-parallel-programs" class="headerlink" title="How to use LLVM to optimize your parallel programs"></a>How to use LLVM to optimize your parallel programs</h2><h2 id="LLVM-backend-development-by-example-RISC-V"><a href="#LLVM-backend-development-by-example-RISC-V" class="headerlink" title="LLVM backend development by example (RISC-V)"></a>LLVM backend development by example (RISC-V)</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:20:31.000Z" title="2023/12/1 22:20:31">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-03T07:02:19.138Z" title="2023/12/3 15:02:19">2023-12-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">几秒读完 (大约37个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2016/">2016</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2016-03/">https://llvm.org/devmtg/2016-03/</a></p>
<h2 id="New-LLD-linker-for-ELF"><a href="#New-LLD-linker-for-ELF" class="headerlink" title="New LLD linker for ELF"></a>New LLD linker for ELF</h2><h2 id="A-closer-look-at-ARM-code-size"><a href="#A-closer-look-at-ARM-code-size" class="headerlink" title="A closer look at ARM code size"></a>A closer look at ARM code size</h2><h2 id="A-journey-of-OpenCL-2-0-development-in-Clang"><a href="#A-journey-of-OpenCL-2-0-development-in-Clang" class="headerlink" title="A journey of OpenCL 2.0 development in Clang"></a>A journey of OpenCL 2.0 development in Clang</h2><p>@ARM</p>
<h2 id="C-on-Accelerators-Supporting-Single-Source-SYCL-and-HSA-Programming-Models-Using-Clang"><a href="#C-on-Accelerators-Supporting-Single-Source-SYCL-and-HSA-Programming-Models-Using-Clang" class="headerlink" title="C++ on Accelerators: Supporting Single-Source SYCL and HSA Programming Models Using Clang"></a>C++ on Accelerators: Supporting Single-Source SYCL and HSA Programming Models Using Clang</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-01T14:16:38.000Z" title="2023/12/1 22:16:38">2023-12-01</time>发表</span><span class="level-item"><time dateTime="2023-12-10T14:08:30.466Z" title="2023/12/10 22:08:30">2023-12-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">3 分钟读完 (大约444个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/01/LLVMDeveloperMeeting/2015/">2015</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2015-10/#tutorials">https://llvm.org/devmtg/2015-10/#tutorials</a></p>
<h2 id="Creating-an-SPMD-Vectorizer-for-OpenCL-with-LLVM"><a href="#Creating-an-SPMD-Vectorizer-for-OpenCL-with-LLVM" class="headerlink" title="Creating an SPMD Vectorizer for OpenCL with LLVM"></a>Creating an SPMD Vectorizer for OpenCL with LLVM</h2><p>@codeplay</p>
<h3 id="SPMD-execution-model"><a href="#SPMD-execution-model" class="headerlink" title="SPMD execution model"></a>SPMD execution model</h3><ul>
<li>On GPU<ul>
<li>Divide work between lanes of SIMD units (fine division)</li>
<li>SIMD execution in lockstep</li>
</ul>
</li>
<li>On CPU<ul>
<li>Divide work between cores (coarse division)</li>
<li>Sequential execution within a core</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>SIMD lane: execution of one instance of a vectorized kernel</li>
<li>SIMD width: length of parallel lanes $N$</li>
<li>Packet: Map 1 value of origin function to $N$ value, one per SIMD lane</li>
</ul>
</blockquote>
<h3 id="Vectorization"><a href="#Vectorization" class="headerlink" title="Vectorization"></a>Vectorization</h3><ul>
<li>vertical<ul>
<li>loops within a kernel</li>
</ul>
</li>
<li>horizental<ul>
<li>compute multiple work at the same time</li>
<li>does not depend on intra special code patterns</li>
<li>SPMD vectorizier</li>
</ul>
</li>
</ul>
<h4 id="Implementation-Level-IR-or-MI"><a href="#Implementation-Level-IR-or-MI" class="headerlink" title="Implementation Level: IR or MI?"></a>Implementation Level: IR or MI?</h4><p>IR更加通用，但是不能用platform-specific特性；MachineInstr则相反。</p>
<p>同时实现：在IR层进行变换，生成CFG元数据，然后利用这些数据在后端进行MI-level预测。</p>
<h3 id="Implementing-a-SPMD-vectorizer"><a href="#Implementing-a-SPMD-vectorizer" class="headerlink" title="Implementing a SPMD vectorizer"></a>Implementing a SPMD vectorizer</h3><ul>
<li>pipeline design</li>
<li>analysis<ul>
<li>Uniform value analysis (UVA)</li>
<li>Divergence analysis</li>
<li>SIDM width analysis</li>
<li>…</li>
</ul>
</li>
</ul>
<h4 id="Packetization-overview"><a href="#Packetization-overview" class="headerlink" title="Packetization overview"></a>Packetization overview</h4><p>Functionality: $F \stackrel{N}{\rightarrow}VF_N$.</p>
<ul>
<li>uniform instructions can remain scalar, executed once per work-group</li>
<li>dependso on UVA to know which instructions to vectorize</li>
</ul>
<h4 id="Scalarization-overview"><a href="#Scalarization-overview" class="headerlink" title="Scalarization overview"></a>Scalarization overview</h4><ul>
<li>eliminate vector operations from source function</li>
<li>vector types used likely to be narrower than the native SIDM width</li>
</ul>
<h4 id="Control-flow-conversion-overview"><a href="#Control-flow-conversion-overview" class="headerlink" title="Control flow conversion overview"></a>Control flow conversion overview</h4><ul>
<li>lineraizes functions that have divergent control flow: conversions from control flow to data flow</li>
<li>single program counter per SIMD group</li>
</ul>
<p>Main steps:</p>
<ul>
<li>divergence analysis</li>
<li>generate masks</li>
<li>freeze loop live variables</li>
<li>apply masks</li>
<li>convert phi nodes</li>
<li>CFG linerization</li>
</ul>
<h2 id="Polly-Optimistic-Loop-Nest-Optimizations-with-Schedule-Trees"><a href="#Polly-Optimistic-Loop-Nest-Optimizations-with-Schedule-Trees" class="headerlink" title="Polly - Optimistic Loop Nest Optimizations with Schedule Trees"></a>Polly - Optimistic Loop Nest Optimizations with Schedule Trees</h2><p>@ETH</p>
<h3 id="Models"><a href="#Models" class="headerlink" title="Models"></a>Models</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt;= i; j++)</span><br><span class="line">    <span class="built_in">S</span>(i, j);</span><br></pre></td></tr></table></figure>

<p>$$<br>\begin{align*}<br>&amp;\mathcal{I}_S &#x3D; { S(i, j) | 0 \leq i \leq n \wedge 0 \leq j \leq i }\</p>
<p>&amp;\Theta_S &#x3D; { S(i, j) \rightarrow (i, j) }<br>\end{align*}<br>$$</p>
<p>After interchange</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt;= i; j++)</span><br><span class="line">    <span class="built_in">S</span>(j, i);</span><br></pre></td></tr></table></figure>

<p>$$<br>\begin{align*}<br>&amp;\mathcal{I}_S &#x3D; { S(i, j) | 0 \leq i \leq n \wedge 0 \leq j \leq i }\</p>
<p>&amp;\Theta_S &#x3D; { S(i, j) \rightarrow (j, i) }<br>\end{align*}<br>$$</p>
<p>The complete Polyhederal model:</p>
<ul>
<li>Iteration Space: set of all statement instances<br><br>${ S(i, j) | 0 \leq i, j \leq n }$<br><br><code>ScopStmt::getDomain()</code></li>
<li>Schedule: Execution time<br><br>${ S(i, j) \rightarrow (i, j) }$<br><br><code>ScopStmt::getSchedule()</code></li>
<li>Access Relation: Memory read&#x2F;write<br><br>${ S(i, j) \rightarrow A(i, j); S(i, j) \rightarrow A(i, j+1) }$<br><br><code>MemoryAccess::getRelation()</code></li>
</ul>
<p>通过这些数据，我们能够计算：</p>
<ul>
<li>数据依赖分析</li>
<li>访问的内存空间</li>
</ul>
<h3 id="Schedule-trees"><a href="#Schedule-trees" class="headerlink" title="Schedule trees"></a>Schedule trees</h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-11-30T13:36:47.000Z" title="2023/11/30 21:36:47">2023-11-30</time>发表</span><span class="level-item"><time dateTime="2023-12-04T03:22:14.310Z" title="2023/12/4 11:22:14">2023-12-04</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/LLVM-Meetings/">LLVM Meetings</a></span><span class="level-item">9 分钟读完 (大约1414个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/11/30/LLVMDeveloperMeeting/2017/">2017</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2017-03/">https://llvm.org/devmtg/2017-03/</a></p>
<p><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2017-10/">https://llvm.org/devmtg/2017-10/</a></p>
<h2 id="Introduction-to-LLVM"><a href="#Introduction-to-LLVM" class="headerlink" title="Introduction to LLVM"></a>Introduction to LLVM</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compilation</span></span><br><span class="line">clang++ file.cpp</span><br><span class="line"><span class="comment"># generate IR</span></span><br><span class="line">clang++ -S -emit-llvm file.cpp</span><br><span class="line"><span class="comment"># run IR</span></span><br><span class="line">lli file.ll</span><br><span class="line"><span class="comment"># generate binary form .bc of IR</span></span><br><span class="line">llvm-as file.ll</span><br><span class="line"><span class="comment"># generate assembly from .bc</span></span><br><span class="line">llc file.bc</span><br><span class="line"><span class="comment"># query availible targets</span></span><br><span class="line">llc file.bc -mcpu=<span class="built_in">help</span></span><br><span class="line"><span class="comment"># opt as analysis tool</span></span><br><span class="line">opt file.ll --time-passes</span><br><span class="line"><span class="comment"># link two or more bitcode file into one file</span></span><br><span class="line">llvm-link file1.ll file2.ll -S -o output.ll</span><br></pre></td></tr></table></figure>

<h3 id="Passes-of-LLVM"><a href="#Passes-of-LLVM" class="headerlink" title="Passes of LLVM"></a>Passes of LLVM</h3><p>According to granularity:</p>
<ul>
<li>module pass</li>
<li>call graph pass</li>
<li>function pass</li>
<li>basic block pass</li>
<li>…</li>
</ul>
<p>According to functionality:</p>
<ul>
<li>analysis pass</li>
<li>transform pass</li>
</ul>
<h3 id="Writing-a-function-pass"><a href="#Writing-a-function-pass" class="headerlink" title="Writing a function pass"></a>Writing a function pass</h3><p>Source code see <a target="_blank" rel="noopener" href="https://www.mshah.io/fosdem18.html">here</a>. </p>
<p>编写的pass放在 <code>$LLVM_TOP/llvm/lib/Transforms/Hello</code> 中。因为这个目录本来就包含于LLVM中，所以一切修改完成后只要在build目录下make即可。完成后在 <code>build/lib</code> 下能找到 <code>LLVMHello.so</code>。</p>
<h4 id="Run-the-pass-with-opt"><a href="#Run-the-pass-with-opt" class="headerlink" title="Run the pass with opt"></a>Run the pass with opt</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opt -load LLVMHello.so -hello &lt; hello.bc &gt; /dev/null</span><br><span class="line">opt -load LLVMHello.so -hello &lt; hello.ll &gt; /dev/null</span><br></pre></td></tr></table></figure>

<blockquote>
<p>LLVM还能输出图片形式的CFG</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt -dot-cfg-only file.ll &gt; /dev/null</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="入手LLVM的建议"><a href="#入手LLVM的建议" class="headerlink" title="入手LLVM的建议"></a>入手LLVM的建议</h3><ol>
<li>打开doxygen文档</li>
<li><code>grep --include=&quot;*.cpp&quot; -nr &quot;getInstructions()&quot;</code> 来查询某一个函数的用法</li>
</ol>
<h3 id="Dynamic-analysis"><a href="#Dynamic-analysis" class="headerlink" title="Dynamic analysis"></a>Dynamic analysis</h3><p>Inject code to moniter or change behaviou of codes.</p>
<ol>
<li>Write hook or profiling code</li>
<li>Generate IR for hook</li>
<li>Find the code to modify</li>
<li>Time for module pass<ul>
<li>create a stub</li>
<li>iterate the module</li>
<li>make modification</li>
</ul>
</li>
</ol>
<p>这些都是基于 <code>llvm-link</code> 进行。</p>
<h2 id="Weak-Memory-Concurrency-in-C-C-11-and-LLVM"><a href="#Weak-Memory-Concurrency-in-C-C-11-and-LLVM" class="headerlink" title="Weak Memory Concurrency in C&#x2F;C++11 and LLVM"></a>Weak Memory Concurrency in C&#x2F;C++11 and LLVM</h2><h2 id="ARM-Code-Size-Optimisations"><a href="#ARM-Code-Size-Optimisations" class="headerlink" title="ARM Code Size Optimisations"></a>ARM Code Size Optimisations</h2><h2 id="SPIR-V-infrastructure-and-its-place-in-the-LLVM-ecosystem"><a href="#SPIR-V-infrastructure-and-its-place-in-the-LLVM-ecosystem" class="headerlink" title="SPIR-V infrastructure and its place in the LLVM ecosystem"></a>SPIR-V infrastructure and its place in the LLVM ecosystem</h2><p>@ARM</p>
<h3 id="SPIR-V-structure"><a href="#SPIR-V-structure" class="headerlink" title="SPIR-V structure"></a>SPIR-V structure</h3><ul>
<li>SPIR-V capabilities</li>
<li>Memory model &amp; addressing model</li>
<li>Entry point of kernels&#x2F;shaders</li>
</ul>
<h3 id="Difference-between-LLVM-and-SPIR-V"><a href="#Difference-between-LLVM-and-SPIR-V" class="headerlink" title="Difference between LLVM and SPIR-V"></a>Difference between LLVM and SPIR-V</h3><ul>
<li>Structured control flow<ul>
<li>Vulkan shaders require structure control flow</li>
<li>OpenCL requires reducible control flow</li>
<li>LLVM can produce irreducible control flow</li>
</ul>
</li>
<li>Reliance on metadata<ul>
<li>OepnCL relies on metadata to express semantics</li>
<li>SPIR-V represents those as SPIR-V opcodes</li>
</ul>
</li>
<li>Uniform control flow<ul>
<li>SPIR-V has native opcodes to represent barrier operation and cross work-group operations</li>
<li>LLVM introduce convergence function attribute to represent a similar concept</li>
</ul>
</li>
<li>Composible types</li>
</ul>
<h3 id="Tooling-NOT-official"><a href="#Tooling-NOT-official" class="headerlink" title="Tooling (NOT official)"></a>Tooling (NOT official)</h3><ul>
<li><code>spirv-opt</code></li>
<li><code>spirv-assembler</code></li>
<li><code>spirv-dis</code></li>
<li><code>spirv-val</code></li>
<li><code>spirv-cfg</code></li>
<li>SPIRV-LLVM converter</li>
</ul>
<h2 id="Bringing-link-time-optimization-to-the-embedded-world-Thin-LTO-with-Linker-Scripts"><a href="#Bringing-link-time-optimization-to-the-embedded-world-Thin-LTO-with-Linker-Scripts" class="headerlink" title="Bringing link-time optimization to the embedded world: (Thin)LTO with Linker Scripts"></a>Bringing link-time optimization to the embedded world: (Thin)LTO with Linker Scripts</h2><h2 id="lld-A-Fast-Simple-and-Portable-Linker"><a href="#lld-A-Fast-Simple-and-Portable-Linker" class="headerlink" title="lld: A Fast, Simple, and Portable Linker"></a>lld: A Fast, Simple, and Portable Linker</h2><h2 id="Writing-Great-Machine-Schedulers"><a href="#Writing-Great-Machine-Schedulers" class="headerlink" title="Writing Great Machine Schedulers"></a>Writing Great Machine Schedulers</h2><p>@ARM</p>
<h3 id="Instruction-scheduling-in-LLVM"><a href="#Instruction-scheduling-in-LLVM" class="headerlink" title="Instruction scheduling in LLVM"></a>Instruction scheduling in LLVM</h3><ul>
<li>“Legacy scheduler”: ScheduleDAGRRList<ul>
<li>Brings instruction DAG into a lineaer order of MIs</li>
</ul>
</li>
<li>“Newer”: MachineScheduler</li>
</ul>
<p>目前主要的调度都在基本块内进行；全局调度仍然是一个等待解决的问题。</p>
<h4 id="Pre-RA-Register-Allocation-scheduling"><a href="#Pre-RA-Register-Allocation-scheduling" class="headerlink" title="Pre-RA (Register Allocation) scheduling"></a>Pre-RA (Register Allocation) scheduling</h4><p>提前进行指令调度能够影响指令的活跃区间，从而减少寄存器占用，减少溢出操作。</p>
<h4 id="RA"><a href="#RA" class="headerlink" title="RA"></a>RA</h4><p>这个时候可能会引入“读后写”假依赖关系。</p>
<h4 id="Post-RA-scheduling"><a href="#Post-RA-scheduling" class="headerlink" title="Post RA scheduling"></a>Post RA scheduling</h4><p>根据资源约束、延迟进行调度。</p>
<h3 id="GenericScheduler-tryCandidate"><a href="#GenericScheduler-tryCandidate" class="headerlink" title="GenericScheduler::tryCandidate"></a><code>GenericScheduler::tryCandidate</code></h3><p>多种方式设计调度策略：</p>
<ul>
<li>Top-down</li>
<li>Bottom-up</li>
<li>Bidirectional (default)</li>
</ul>
<p><code>tryCandidate</code> 能根据启发式从中选取最好的一个策略。</p>
<ul>
<li>physical register copies</li>
<li>register pressure (excess and critical pressure)</li>
<li>acyclic latency</li>
<li>cluster</li>
<li>resgister pressure (current max)</li>
<li>latency</li>
<li>source order</li>
</ul>
<h3 id="Modelling-pipeline-for-machine-scheduler"><a href="#Modelling-pipeline-for-machine-scheduler" class="headerlink" title="Modelling pipeline for machine scheduler"></a>Modelling pipeline for machine scheduler</h3><ul>
<li><code>ScheduleDAGMI</code></li>
<li><code>Scheduler</code></li>
<li><code>TargetSchedModel</code></li>
</ul>
<p>Describe a machine model:</p>
<ul>
<li>For target:<ol>
<li>difines operand categories (<code>SchedReadWrite</code>), e.g. ARMSchedule.td</li>
<li>associates categories with actual instructions, e.g. ARMInstrInfo.td</li>
</ol>
</li>
<li>For sub-target:<ol start="3">
<li>defines description of pipeline and resources, e.g. ARMScheduleR52.td, <code>def CortexR52Model : ShcedMachineModel &#123;...&#125;</code></li>
<li>associates categories with resource and latencies, e.g. ARMScheduleR52.td, <code>def AP2UnitALU: ...</code> (resource consumed by writers), <code>def : WriteRes&lt;WriteALU, [AP2UnitALU]&gt; &#123;...&#125;</code> (associate resources and latency)</li>
</ol>
</li>
</ul>
<h4 id="TableGen-debug"><a href="#TableGen-debug" class="headerlink" title="TableGen debug"></a>TableGen debug</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">llvm-tblgen --debug-only=subtarget-emitter --print-records -I=<span class="variable">$LLVM_TOP</span>/llvm/include ...</span><br><span class="line">llc -enable-misched -debug-only=machine-scheduler</span><br></pre></td></tr></table></figure>

<h3 id="Modeling-for-more-specific-hardware-feature"><a href="#Modeling-for-more-specific-hardware-feature" class="headerlink" title="Modeling for more specific hardware feature"></a>Modeling for more specific hardware feature</h3><h4 id="Subtarget-override-of-specific-opcodes"><a href="#Subtarget-override-of-specific-opcodes" class="headerlink" title="Subtarget override of specific opcodes"></a>Subtarget override of specific opcodes</h4><ol>
<li>define a new <code>SchedWrite</code>, named attached resource</li>
<li>map list of opcodes to the <code>SchedWrite</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def PWriteSALU: SchedWriteRes&lt;[APUnitALU]&gt; &#123;</span><br><span class="line">  let Latency=4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def : InsrRW&lt;[PWriteSALU, ReadALU], instregex &quot;CLZ&quot;&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="Customizing-the-MachineScheduler"><a href="#Customizing-the-MachineScheduler" class="headerlink" title="Customizing the MachineScheduler"></a>Customizing the MachineScheduler</h3><h4 id="Customize-scheduling-policy"><a href="#Customize-scheduling-policy" class="headerlink" title="Customize scheduling policy"></a>Customize scheduling policy</h4><ol>
<li>Implement <code>overrideSchedPolicy</code> in subtarget</li>
</ol>
<h4 id="Customize-MachineSchedStrategy-implementation"><a href="#Customize-MachineSchedStrategy-implementation" class="headerlink" title="Customize MachineSchedStrategy implementation"></a>Customize MachineSchedStrategy implementation</h4><ol>
<li>Implement <code>MachineSchedStrategy</code></li>
<li>Register new strategy for target <code>createMachineScheduler</code></li>
</ol>
<h4 id="DAG-mutations"><a href="#DAG-mutations" class="headerlink" title="DAG mutations"></a>DAG mutations</h4><p>These allow adding scheduling constraints:</p>
<ul>
<li>Weak edges (cluster, artificial)</li>
<li>Adjust dependence using target-specific knowledge</li>
</ul>
<ol>
<li>Implemenmt DAG mutation (<code>ScheduleDAGMutation</code>)</li>
<li>Register DAG mutation (<code>createMachineScheduler</code>)</li>
</ol>
<h2 id="Welcome-to-the-back-end-The-LLVM-machine-representation"><a href="#Welcome-to-the-back-end-The-LLVM-machine-representation" class="headerlink" title="Welcome to the back-end: The LLVM machine representation"></a>Welcome to the back-end: The LLVM machine representation</h2><p>@Apple</p>
<p>LLVM Machine IR (MIR):</p>
<ul>
<li>Machine specific instructions</li>
<li>Tasks<ul>
<li>Resource allocation</li>
<li>Lowering ABI, exception handling, debug info, …</li>
<li>Optimization: peephole, instruction&#x2F;block scheduling …</li>
</ul>
</li>
<li>Tighten constraints pass pipeline</li>
</ul>
<h3 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h3><ul>
<li>Writing an LLVM target<ul>
<li>Implement <code>TargetMachine</code> interface</li>
</ul>
</li>
<li>Code generation pipeline</li>
<li>Pass manager setup<ul>
<li><code>TargetPassConfig</code></li>
<li>Override the methods to add&#x2F;remove&#x2F;replace passes</li>
<li><code>insertPass</code> and <code>substitutePass</code> are also useful</li>
</ul>
</li>
<li>Instructions<ul>
<li><code>class MachineInstruction</code> (MI)</li>
<li>Opcode</li>
<li>Pointer to Machine Basic Block</li>
<li>Operand array</li>
<li>Debugging location</li>
</ul>
</li>
<li>Operands<ul>
<li><code>class MachineOperand</code> (MOP)</li>
<li>Register &amp; register mask</li>
<li>Immediates</li>
<li>…</li>
</ul>
</li>
<li>Opecode<ul>
<li><code>class MCInstrDesc</code></li>
<li>Flags (side effect, transformation hint, …)</li>
</ul>
</li>
<li>Basic blocks<ul>
<li><code>class MachineBasicBlock</code> (MBB)</li>
<li>Double linked list of instructions</li>
<li>Numbered</li>
<li>Arrays with predecessor&#x2F;successor blocks with execution frenquency</li>
</ul>
</li>
<li>Functions<ul>
<li><code>class MachineFunction</code> (MF)</li>
<li>Double linked list of basic blocks</li>
<li>Pointers to IR <code>Function</code>, <code>TargetMahchine</code>, <code>MCContext</code>, …</li>
<li>State <code>MachineResisterInfo</code>, <code>MachineFrameInfo</code>, <code>MachineConstantPoop</code>, <code>MachineJumpTableInfo</code></li>
</ul>
</li>
</ul>
<h3 id="Develop-tips"><a href="#Develop-tips" class="headerlink" title="Develop tips"></a>Develop tips</h3><ul>
<li><p>Produce .ll then use llc</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clang -S -O1 -emit-llvm a.c -o a.ll</span><br><span class="line">llc a.ll</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enable debug output</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llc -debug ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Debug output for passes <code>foo</code> and <code>bar</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llc -debug-only=foo,bar ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Driven with clang</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clang -mllvm -debug-only=foo,bar ...</span><br><span class="line">clang -mllvm -print-machineinstrs ...</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Testing-MIR-file-format"><a href="#Testing-MIR-file-format" class="headerlink" title="Testing: MIR file format"></a>Testing: MIR file format</h3><ul>
<li><p>Stop after pass <code>isel</code> and write .mir file</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llc -stop-after=isel a.ll -o a.mir</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load .mir file, run pass, write .mir file</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llc -run-pass=machine-shceduler a.mir -o a_scheduled.mir</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load .mir file nad start code generation pipeline after pass <code>isel</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">llc -start-after=isel a.mir -o a.s</span><br><span class="line">llc -start-before=isel a.mir -o a.s</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>Both <code>-start-before</code> and <code>-start-after</code> often fails</p>
</blockquote>
<ul>
<li>Check a MIR whether is valid<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llc -verify-machineinstrs ...</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Register-allocation"><a href="#Register-allocation" class="headerlink" title="Register allocation"></a>Register allocation</h3><h4 id="Physical-registers"><a href="#Physical-registers" class="headerlink" title="Physical registers"></a>Physical registers</h4><ul>
<li>Defined by target <code>typedef uint16_t MCPhysReg</code></li>
<li><code>MachineRegisterInfo</code> maintains list of uses and definitions per register</li>
<li>Register classes are sets of registers</li>
<li>Register constraints modeled with classes</li>
</ul>
<h4 id="Virtual-registers"><a href="#Virtual-registers" class="headerlink" title="Virtual registers"></a>Virtual registers</h4><ul>
<li>Managed by <code>MachineRegisterInfo</code></li>
<li>Both virtual and physical registers stored in <code>unsigned</code></li>
<li><code>MachineRegisterInfo::isVirtualRegister(Reg)</code> v.s <code>MachineRegisterInfo:isPhysicalResgister(Reg)</code></li>
<li>Register &#x3D;&#x3D; 0: No register used</li>
</ul>
<h4 id="Representation-with-register-flags"><a href="#Representation-with-register-flags" class="headerlink" title="Representation with register flags"></a>Representation with register flags</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">; X86 rotate left</span><br><span class="line">%EDI&lt;def,tied1&gt; = ROL32rCL %EDI&lt;kill,tied0&gt;m %EFLAGS&lt;imp-def&gt;, %CL&lt;imp-use&gt;</span><br><span class="line"></span><br><span class="line">; equal to x86 assembly</span><br><span class="line">roll %cl, %edi</span><br></pre></td></tr></table></figure>

<ul>
<li><code>imp</code>: implicite, not emitted</li>
<li><code>tied</code>: same register for Def+Use</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">; X86 XOR/Zero register</span><br><span class="line">%EAX&lt;def,tied1&gt; = XOR32rr %EAX&lt;undef, tied0&gt;, %EAX&lt;undef&gt;, %EFLAGS&lt;imp-def&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>undef</code>: register value doesn’t matter</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; X86 Set 0/1</span><br><span class="line">%vreg0&lt;def&gt; = MOV32r0 ...</span><br><span class="line">%vreg0:sub_8bit&lt;def&gt; = SETLr %EFLAGS&lt;imp-use&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>subregindex: read&#x2F;write part of a virtual register (anatomy to the relation between RAX&#x2F;EAX&#x2F;AX&#x2F;AL&#x2F;AH)</li>
</ul>
<p>Liveness indicator flags: <code>dead</code> and <code>kill</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL &lt;ga:@func&gt;, &lt;regmask %LR, %FP, %X19, %X20, ...&gt;, ...</span><br></pre></td></tr></table></figure>

<ul>
<li><code>regmask</code>: preserves %LR, %FP, %X19, %X20, clobber every other registers</li>
</ul>
<h4 id="Liveness-tracking"><a href="#Liveness-tracking" class="headerlink" title="Liveness tracking"></a>Liveness tracking</h4><ul>
<li>Linearize program</li>
<li><code>SlotIndexes</code> maintains numbering of instructions</li>
<li>Slots per instructions</li>
</ul>
<h4 id="Register-allocation-tuning"><a href="#Register-allocation-tuning" class="headerlink" title="Register allocation tuning"></a>Register allocation tuning</h4><ul>
<li><p>XXXRegisterInfo.td: adjust allocation order</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def GR32: RegisterClass&lt;&quot;X86&quot;, [i32], 32, </span><br><span class="line">                        (add EAX, ECX, EDX, ...)&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Set register class allocation priority</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Tuple of 2 32bit registers</span><br><span class="line">def VReg_64 : RegisterClass&lt;&quot;AMDGPU&quot;, [i64], 32, (add VGPR_64)&gt; &#123;</span><br><span class="line">  let AllocationPriority = 2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Hinting</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class TargetRegisterInfo &#123; // ...</span><br><span class="line">  virtual void getRegAllocationHints(unsigned VirtReg,</span><br><span class="line">      ArrayRef&lt;MCPhysReg Order, SmallVectorImpl&lt;MCPhysReg&gt; &amp;Hints, /*...*/);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Liveness-tracking-after-register-allocation"><a href="#Liveness-tracking-after-register-allocation" class="headerlink" title="Liveness tracking after register allocation"></a>Liveness tracking after register allocation</h4><ul>
<li>Use <code>LiveRegUnits</code>&#x2F;<code>LivePhysRegs</code> to compute liveness for instructions inside a block</li>
</ul>
<h4 id="Prolog-and-epilog-insertion-pass"><a href="#Prolog-and-epilog-insertion-pass" class="headerlink" title="Prolog and epilog insertion pass"></a>Prolog and epilog insertion pass</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TargetFrameLowering</span> &#123; <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">emitPrologue</span><span class="params">(MachineFunction &amp;MF, MachineBasicBlock &amp;MBB)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">emitEpilogue</span><span class="params">(MachineFunction &amp;MF, MachineBasicBlock &amp;MBB)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">determineCalleeSaves</span><span class="params">(MachineFunction &amp;MF, BitVector &amp;SavedRegs, <span class="comment">/*...*/</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">processFunctionBeforeFrameFinalized</span><span class="params">(MachineFunction &amp;MF, <span class="comment">/*...*/</span>)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Setup call frames, setup stack frame</li>
<li>Save&#x2F;Restore callee saved registers</li>
<li>resolve frame indexes</li>
<li>register scavenging<ul>
<li>Last step of prolog epilog insertion</li>
<li>simulate liveness in basic block, allocate virtual registers</li>
<li>execute spills and reloads<br><br><code>RegScavenger::addScavengingFrameIndex(int FrameIndex)</code></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">STRi12 %R1, &lt;fi#2&gt;, 0, ...</span><br><span class="line">            ^ frame index, currently a placeholder</span><br><span class="line">STRi12 %R1, %SP, 4104, ...</span><br><span class="line">            ^ resolved frame index</span><br><span class="line">%verg0&lt;def&gt; = ADDri %SP, 4096, ...</span><br><span class="line">STRi12 %R1, %vreg0, 8, ...</span><br><span class="line">            ^ may introduce temporary register</span><br></pre></td></tr></table></figure></div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/gallery/head-portrial.jpg" alt="ReRoozen"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ReRoozen</p><p class="is-size-6 is-block">I need more power!!!</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Within Heaven and Hell</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">53</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">16</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Assembly-Language/"><span class="level-start"><span class="level-item">Assembly Language</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Benchmarks/"><span class="level-start"><span class="level-item">Benchmarks</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CMAKE/"><span class="level-start"><span class="level-item">CMAKE</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Design-Patterns-in-CPP/"><span class="level-start"><span class="level-item">Design Patterns in CPP</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/LLVM/"><span class="level-start"><span class="level-item">LLVM</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/LLVM-Meetings/"><span class="level-start"><span class="level-item">LLVM Meetings</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/MLIR/"><span class="level-start"><span class="level-item">MLIR</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Modern-CPP/"><span class="level-start"><span class="level-item">Modern CPP</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/PFPL/"><span class="level-start"><span class="level-item">PFPL</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Performance-Profiling/"><span class="level-start"><span class="level-item">Performance Profiling</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Polyhedral/"><span class="level-start"><span class="level-item">Polyhedral</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Writing/"><span class="level-start"><span class="level-item">Writing</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/hexo/"><span class="level-start"><span class="level-item">hexo</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/vim/"><span class="level-start"><span class="level-item">vim</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"><span class="level-start"><span class="level-item">环境配置</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-04-23T06:30:10.000Z">2024-04-23</time></p><p class="title"><a href="/2024/04/23/ARMAsm/01-Architecture/">ARMv8 Architecture</a></p><p class="categories"><a href="/categories/Assembly-Language/">Assembly Language</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-04-16T05:24:08.000Z">2024-04-16</time></p><p class="title"><a href="/2024/04/16/PerformanceMeasuring/02-MemoryHierarchical/">02-Measuring Memory Hierarchy</a></p><p class="categories"><a href="/categories/Performance-Profiling/">Performance Profiling</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-04-16T05:24:08.000Z">2024-04-16</time></p><p class="title"><a href="/2024/04/16/PerformanceMeasuring/03-CPUandMemory/">02-Measuring Memory Hierarchy</a></p><p class="categories"><a href="/categories/Performance-Profiling/">Performance Profiling</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-04-16T01:48:32.000Z">2024-04-16</time></p><p class="title"><a href="/2024/04/16/PerformanceMeasuring/01-CPU/">01-Measuring CPU Time</a></p><p class="categories"><a href="/categories/Performance-Profiling/">Performance Profiling</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-04-06T10:34:12.000Z">2024-04-06</time></p><p class="title"><a href="/2024/04/06/DesingnPatterns/1-CreationalPattern/">1-CreationalPattern</a></p><p class="categories"><a href="/categories/Design-Patterns-in-CPP/">Design Patterns in CPP</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ReRoozen&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 ReRoozen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2024</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>